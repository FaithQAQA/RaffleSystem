<ion-app class="app-container">
  <!-- Header -->
  <app-header></app-header>

  <!-- Main Content -->
  <ion-content class="modern-content">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-content glass-card">
        <ion-spinner color="primary"></ion-spinner>
        <p>Loading featured raffles...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !isLoading" class="error-container">
      <div class="error-content glass-card">
        <ion-icon name="warning-outline" class="error-icon"></ion-icon>
        <h3>Unable to Load Raffles</h3>
        <p>{{ errorMessage }}</p>
        <ion-button fill="solid" color="primary" (click)="refreshRaffles()">
          <ion-icon name="refresh-outline" slot="start"></ion-icon>
          Try Again
        </ion-button>
      </div>
    </div>

    <!-- Main Content when loaded -->
    <div *ngIf="!isLoading && !errorMessage">
      <!-- Hero Section -->
      <section class="hero-section">
        <div class="hero-overlay"></div>
        <div class="hero-content glass-card">
          <h1 class="hero-title gradient-text">Featured Raffles</h1>
          <p class="hero-subtitle">
            Support children who are deaf and hard of hearing while winning amazing prizes!
          </p>

          <!-- Cart Indicator -->
          <div class="cart-indicator" *ngIf="cartItemCount > 0">
            <ion-badge color="primary" class="cart-badge">
              <ion-icon name="cart-outline"></ion-icon>
              {{ cartItemCount }} item(s) in cart
            </ion-badge>
          </div>

          <div class="hero-stats">
            <div class="stat-item">
              <ion-icon name="ticket-outline" class="stat-icon"></ion-icon>
              <span class="stat-number">{{ recentRaffles?.length || 0 }}</span>
              <span class="stat-label">Active Raffles</span>
            </div>
            <div class="stat-item">
              <ion-icon name="trending-up-outline" class="stat-icon"></ion-icon>
              <span class="stat-number">{{ getTotalTicketsSold() }}</span>
              <span class="stat-label">Total Tickets Sold</span>
            </div>
            <div class="stat-item">
              <ion-icon name="time-outline" class="stat-icon"></ion-icon>
              <span class="stat-number">{{ getEndingSoonCount() }}</span>
              <span class="stat-label">Ending Soon</span>
            </div>
          </div>
        </div>
      </section>

      <div aria-live="polite" class="visually-hidden" id="liveRegion"></div>

      <!-- Raffles Grid -->
      <section class="raffles-section">
        <div class="section-header">
          <h2 class="section-title">Current Raffles</h2>
          <p class="section-subtitle">Choose your favorite and make a difference</p>
        </div>

        <ion-grid class="raffle-gallery">
          <ion-row>
            <ion-col
              *ngFor="let raffle of recentRaffles; trackBy: trackByRaffleId"
              size="12"
              size-md="6"
              size-lg="4"
              class="raffle-col"
            >
              <ion-card
                class="raffle-card glass-card"
                (click)="goToRaffleDetail(raffle._id)"
                tabindex="0"
                [attr.aria-label]="getRaffleAriaLabel(raffle)"
              >
                <!-- Status Badges -->
                <div class="card-badges">
                  <!-- Urgent Badge -->
                  <div class="card-badge" *ngIf="raffle._remainingTickets > 0 && raffle._remainingTickets <= 20">
                    <ion-badge color="danger" class="urgent-badge">
                      <ion-icon name="flash-outline"></ion-icon>
                      Only {{ raffle._remainingTickets }} left!
                    </ion-badge>
                  </div>

                  <!-- Ending Soon Badge -->
                  <div class="card-badge" *ngIf="isEndingSoon(raffle)">
                    <ion-badge color="warning" class="ending-badge">
                      <ion-icon name="time-outline"></ion-icon>
                      Ends in {{ getDaysUntilEnd(raffle) }} days
                    </ion-badge>
                  </div>

                  <!-- New Badge -->
                  <div class="card-badge new-badge" *ngIf="isNewRaffle(raffle)">
                    <ion-badge color="success" class="new-arrival-badge">
                      <ion-icon name="sparkles-outline"></ion-icon>
                      New
                    </ion-badge>
                  </div>

                  <!-- Sold Out Badge -->
                  <div class="card-badge" *ngIf="raffle._remainingTickets <= 0">
                    <ion-badge color="dark" class="sold-out-badge">
                      <ion-icon name="close-circle-outline"></ion-icon>
                      Sold Out
                    </ion-badge>
                  </div>
                </div>

                <div class="card-image-container">
                  <img
                    [src]="getRaffleImage(raffle)"
                    [attr.alt]="'Raffle image for ' + raffle.title"
                    loading="lazy"
                    class="raffle-image"
                    (error)="handleImageError($event)"
                  />
                  <div class="image-overlay">
                    <div class="overlay-content">
                      <ion-button fill="clear" color="light" class="quick-view-btn">
                        <ion-icon name="eye-outline" slot="start"></ion-icon>
                        View Details
                      </ion-button>
                    </div>
                  </div>
                </div>

                <ion-card-header class="card-header">
                  <ion-card-title class="raffle-title-text">{{ raffle.title || 'Untitled Raffle' }}</ion-card-title>
                  <ion-card-subtitle class="raffle-subtitle-text">
                    <ion-icon name="calendar-outline"></ion-icon>
                    {{ getRaffleDateInfo(raffle) }}
                  </ion-card-subtitle>
                </ion-card-header>

                <ion-card-content class="card-content">
                  <p class="raffle-description">{{ getRaffleDescription(raffle) }}</p>

                  <!-- Progress Section -->
                  <div class="progress-section" *ngIf="raffle._remainingTickets > 0">
                    <div class="progress-header">
                      <span class="progress-label">Tickets Sold</span>
                      <span class="progress-percentage">
                        {{ raffle._progress }}%
                      </span>
                    </div>
                    <ion-progress-bar
                      [value]="raffle._progress / 100"
                      [color]="getProgressColor(raffle)"
                      class="progress-bar"
                    ></ion-progress-bar>
                    <div class="progress-stats">
                      <small class="progress-text">
                        {{ raffle.ticketsSold }} / {{ raffle.totalTickets }} tickets
                      </small>
                      <small class="progress-remaining">
                        {{ raffle._remainingTickets }} remaining
                      </small>
                    </div>
                  </div>

                  <!-- Price and Action Section -->
                  <div class="action-section">
                    <div class="price-info">
                      <ion-chip
                        [color]="raffle._remainingTickets <= 0 ? 'medium' : 'primary'"
                        class="price-chip"
                        [outline]="raffle._remainingTickets > 0"
                      >
                        <ion-icon name="cash-outline"></ion-icon>
                        <ion-label>${{ raffle.price }} per ticket</ion-label>
                      </ion-chip>

                      <!-- Popular Badge -->
                      <ion-badge
                        *ngIf="raffle._progress > 70 && raffle._remainingTickets > 0"
                        color="warning"
                        class="popular-badge"
                      >
                        <ion-icon name="flame-outline"></ion-icon>
                        Popular
                      </ion-badge>
                    </div>

                    <ion-button
                      expand="block"
                      [color]="raffle._remainingTickets <= 0 ? 'medium' : 'primary'"
                      [fill]="raffle._remainingTickets <= 0 ? 'outline' : 'solid'"
                      class="add-to-cart-btn"
                      (click)="$event.stopPropagation(); handleRaffleAction(raffle)"
                      [disabled]="raffle._remainingTickets <= 0"
                    >
                      <ion-icon
                        [name]="raffle._remainingTickets <= 0 ? 'close-circle-outline' : 'cart-outline'"
                        slot="start"
                      ></ion-icon>
                      {{ raffle._remainingTickets <= 0 ? 'Sold Out' : 'Add to Cart' }}
                    </ion-button>
                  </div>
                </ion-card-content>
              </ion-card>
            </ion-col>
          </ion-row>

          <!-- Empty State -->
          <div *ngIf="recentRaffles.length === 0" class="empty-state">
            <ion-row>
              <ion-col size="12" class="text-center">
                <div class="no-raffles-message glass-card">
                  <ion-icon name="ticket-outline" class="empty-state-icon"></ion-icon>
                  <h3>No Active Raffles Available</h3>
                  <p>We're preparing new exciting raffles for you. Check back soon!</p>
                  <ion-button fill="outline" color="primary" (click)="refreshRaffles()">
                    <ion-icon name="refresh-outline" slot="start"></ion-icon>
                    Refresh
                  </ion-button>
                </div>
              </ion-col>
            </ion-row>
          </div>
        </ion-grid>
      </section>

      <!-- Quick Actions Section -->
      <section class="quick-actions-section">
        <div class="actions-grid">
          <ion-card class="action-card glass-card" routerLink="/view-raffles">
            <div class="action-content">
              <ion-icon name="list-outline" class="action-icon"></ion-icon>
              <h3>All Raffles</h3>
              <p>Browse through all available raffles and opportunities</p>
            </div>
          </ion-card>
        </div>
      </section>
    </div>

    <app-app-footer></app-app-footer>
  </ion-content>
</ion-app>
